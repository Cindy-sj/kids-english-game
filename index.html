<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Kids English Game</title>
  <style>
    :root{
      --pink:#FF77B7;
      --pink2:#FFD1E8;
      --blue:#58C6FF;
      --blue2:#CFEFFF;
      --bg:#FFF7FB;
      --card:#FFFFFF;
      --text:#1f2937;
      --muted:#6b7280;
      --shadow:0 10px 30px rgba(0,0,0,.08);
      --radius:22px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang SC", "Microsoft YaHei", Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% -10%, var(--pink2), transparent 55%),
                  radial-gradient(1200px 600px at 90% 0%, var(--blue2), transparent 50%),
                  var(--bg);
      color:var(--text);
      padding:16px 12px 28px;
    }

    .wrap{
      max-width:980px;
      margin:0 auto;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin:6px 0 12px;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    h1{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
    }
    .sub{
      font-size:14px;
      color:var(--muted);
    }

    .score{
      background: linear-gradient(135deg, var(--pink), var(--blue));
      color:#fff;
      padding:10px 12px;
      border-radius:999px;
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:700;
      white-space:nowrap;
    }
    .score span{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:20px;
    }

    .card{
      background:rgba(255,255,255,.85);
      backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.8);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
    }

    .topRow{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }

    .tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .tab{
      border:none;
      cursor:pointer;
      padding:10px 12px;
      border-radius:999px;
      font-weight:700;
      font-size:14px;
      background:#fff;
      color:var(--text);
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
      border:1px solid rgba(0,0,0,.04);
    }
    .tab.active{
      background: linear-gradient(135deg, var(--pink), var(--blue));
      color:#fff;
      border-color: transparent;
    }

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .btn{
      border:none;
      cursor:pointer;
      padding:12px 14px;
      border-radius:16px;
      font-size:16px;
      font-weight:800;
      box-shadow: 0 8px 22px rgba(0,0,0,.08);
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .btn.primary{
      background: linear-gradient(135deg, var(--pink), var(--blue));
      color:#fff;
    }
    .btn.ghost{
      background:#fff;
      color:var(--text);
      border:1px solid rgba(0,0,0,.06);
    }

    .question{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      margin-top:6px;
    }

    .wordBox{
      background: linear-gradient(135deg, rgba(255,119,183,.20), rgba(88,198,255,.20));
      border: 1px solid rgba(255,255,255,.9);
      border-radius: var(--radius);
      padding:16px 14px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .emoji{
      font-size:52px;
      line-height:1;
      margin-top:4px;
    }
    .en{
      font-size:38px;
      font-weight:900;
      margin:10px 0 2px;
      letter-spacing:.2px;
    }
    .hint{
      font-size:16px;
      color:var(--muted);
      margin:0 0 6px;
    }

    .options{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .opt{
      border:none;
      cursor:pointer;
      padding:16px 14px;
      border-radius:18px;
      font-size:22px;
      font-weight:900;
      background:#fff;
      box-shadow: 0 10px 26px rgba(0,0,0,.06);
      border:2px solid rgba(0,0,0,.04);
      transition: transform .08s ease, border-color .08s ease;
      text-align:center;
    }
    .opt:active{ transform: scale(.98); }
    .opt.good{
      border-color: rgba(22,163,74,.55);
      box-shadow: 0 12px 30px rgba(22,163,74,.12);
    }
    .opt.bad{
      border-color: rgba(220,38,38,.5);
      box-shadow: 0 12px 30px rgba(220,38,38,.10);
    }

    .msg{
      min-height:34px;
      text-align:center;
      font-size:20px;
      font-weight:900;
      margin:6px 0 0;
    }
    .ok{ color:#16a34a; }
    .bad{ color:#dc2626; }

    /* å°å¥–åŠ±åŠ¨ç”»ï¼šæ˜Ÿæ˜Ÿé£å‡º */
    .burst{
      position:absolute;
      inset:0;
      pointer-events:none;
    }
    .star{
      position:absolute;
      font-size:22px;
      opacity:0;
      animation: pop 900ms ease forwards;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.10));
    }
    @keyframes pop{
      0%{ transform: translate(var(--x), var(--y)) scale(.4) rotate(0deg); opacity:0; }
      20%{ opacity:1; }
      70%{ opacity:1; }
      100%{ transform: translate(calc(var(--x) * 1.3), calc(var(--y) * 1.3)) scale(1.25) rotate(20deg); opacity:0; }
    }

    /* æ¡Œé¢ç«¯æ›´å®½æ—¶ï¼Œé€‰é¡¹å˜ä¸¤åˆ— */
    @media (min-width: 720px){
      body{ padding:22px 18px 36px; }
      h1{ font-size:26px; }
      .sub{ font-size:15px; }
      .question{ grid-template-columns: 1fr 1fr; align-items:stretch; }
      .wordBox{ min-height: 260px; display:flex; flex-direction:column; justify-content:center; }
      .options{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>ğŸŒˆ Kids Englishï¼ˆç²‰è“ç‰ˆï¼‰</h1>
        <div class="sub">åˆ†ä¸»é¢˜å­¦ä¹ ï½œç‚¹â€œå¬å‘éŸ³â€ï½œé€‰æ­£ç¡®ä¸­æ–‡å¾— â­</div>
      </div>
      <div class="score" aria-label="score">
        <span>â­</span> <span id="stars">0</span>
      </div>
    </header>

    <div class="card">
      <div class="topRow">
        <div class="tabs" id="tabs"></div>
        <div class="controls">
          <button class="btn ghost" onclick="repeatAudio()">ğŸ”Š å¬å‘éŸ³</button>
          <button class="btn primary" onclick="nextQuestion()">â¡ï¸ ä¸‹ä¸€é¢˜</button>
        </div>
      </div>

      <div class="question">
        <div class="wordBox">
          <div class="burst" id="burst"></div>
          <div class="emoji" id="emoji">ğŸ</div>
          <div class="en" id="enWord">Apple</div>
          <div class="hint" id="hint">è¯·é€‰æ‹©æ­£ç¡®ä¸­æ–‡ï¼ˆä¹Ÿå¯ä»¥å…ˆå¬å‘éŸ³ï¼‰</div>
          <div class="msg" id="msg"></div>
        </div>

        <div>
          <div class="options" id="options"></div>
          <p style="margin:10px 6px 0;color:var(--muted);font-size:13px;">
            å°æç¤ºï¼šå¦‚æœæ‰‹æœºæ²¡å£°éŸ³ï¼Œè¯·æŠŠæ‰‹æœºé™éŸ³å…³é—­ï¼Œå¹¶å…è®¸æµè§ˆå™¨æ’­æ”¾å£°éŸ³ã€‚
          </p>
        </div>
      </div>
    </div>
  </div>

<script>
  /**
   * ä¸»é¢˜å•è¯åº“ï¼šä½ å¯ä»¥ç»§ç»­åŠ 
   * audio: å¦‚æœä½ ä»¥åè¦ç”¨â€œå°æœ‹å‹æ•™è¯»â€mp3ï¼ŒæŠŠéŸ³é¢‘æ–‡ä»¶æ”¾åˆ°ä»“åº“ audio/ ç›®å½•ï¼Œç„¶åè¿™é‡Œå†™è·¯å¾„å³å¯
   * ä¾‹å¦‚ï¼šaudio: "audio/apple.mp3"
   */
  const WORDS_BY_TOPIC = {
    "åŠ¨ç‰© ğŸ¾": [
      { en:"Dog", cn:"ç‹—", emoji:"ğŸ¶", audio:"" },
      { en:"Cat", cn:"çŒ«", emoji:"ğŸ±", audio:"" },
      { en:"Fish", cn:"é±¼", emoji:"ğŸŸ", audio:"" }
    ],
    "æ°´æœ ğŸ‰": [
      { en:"Apple", cn:"è‹¹æœ", emoji:"ğŸ", audio:"" },
      { en:"Banana", cn:"é¦™è•‰", emoji:"ğŸŒ", audio:"" }
    ],
    "äº¤é€š ğŸš—": [
      { en:"Car", cn:"æ±½è½¦", emoji:"ğŸš—", audio:"" }
    ],
    "é£Ÿç‰© ğŸ¥›": [
      { en:"Milk", cn:"ç‰›å¥¶", emoji:"ğŸ¥›", audio:"" },
      { en:"Bread", cn:"é¢åŒ…", emoji:"ğŸ", audio:"" }
    ],
    "æ—¥å¸¸ â˜€ï¸": [
      { en:"Sun", cn:"å¤ªé˜³", emoji:"â˜€ï¸", audio:"" },
      { en:"Ball", cn:"çƒ", emoji:"âš½", audio:"" }
    ],
  };

  // æ¸¸æˆçŠ¶æ€
  let topicNames = Object.keys(WORDS_BY_TOPIC);
  let currentTopic = topicNames[0];
  let current = null;
  let stars = 0;
  let audioEl = null;
  let locked = false; // é˜²æ­¢è¿ç‚¹

  function $(id){ return document.getElementById(id); }

  function shuffle(arr){
    return arr.map(v=>({v, r:Math.random()}))
              .sort((a,b)=>a.r-b.r)
              .map(x=>x.v);
  }

  function allChineseExcept(correctCn){
    const all = topicNames.flatMap(t => WORDS_BY_TOPIC[t].map(w=>w.cn));
    return all.filter(cn => cn !== correctCn);
  }

  // â€”â€” å‘éŸ³ï¼šä¼˜å…ˆæ’­æ”¾ mp3ï¼ˆå°æœ‹å‹å£°éŸ³ï¼‰ï¼Œæ²¡æœ‰å°±ç”¨ç³»ç»Ÿæ ‡å‡†å‘éŸ³ â€”â€”
  function speak(text){
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = 0.86;
    u.pitch = 1.05;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  }

  function playWordAudio(){
    if(!current) return;

    // è‹¥é…ç½®äº† mp3ï¼Œåˆ™ä¼˜å…ˆæ’­æ”¾
    if(current.audio && current.audio.trim()){
      try{
        if(!audioEl) audioEl = new Audio();
        audioEl.src = current.audio;
        audioEl.currentTime = 0;
        audioEl.play().catch(()=> speak(current.en));
      }catch(e){
        speak(current.en);
      }
    }else{
      // æ²¡æœ‰ mp3 æ—¶ï¼Œç”¨æ ‡å‡†å‘éŸ³é¡¶ä¸Š
      speak(current.en);
    }
  }

  function repeatAudio(){
    playWordAudio();
  }

  // â€”â€” æ­£è¯¯éŸ³æ•ˆï¼ˆè½»é‡ WebAudioï¼Œä¸ä¾èµ–å¤–éƒ¨æ–‡ä»¶ï¼‰â€”â€”
  function beep(type="ok"){
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = "sine";
    o.frequency.value = type === "ok" ? 880 : 220;
    g.gain.value = 0.0001;
    o.connect(g); g.connect(ctx.destination);
    o.start();

    const now = ctx.currentTime;
    g.gain.exponentialRampToValueAtTime(0.12, now + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, now + (type === "ok" ? 0.18 : 0.25));
    o.stop(now + (type === "ok" ? 0.20 : 0.28));
    o.onended = ()=> ctx.close();
  }

  // â€”â€” å¥–åŠ±åŠ¨ç”»ï¼ˆæ˜Ÿæ˜Ÿçˆ†ç‚¸ï¼‰â€”â€”
  function starBurst(){
    const box = $("burst");
    box.innerHTML = "";
    const n = 10;
    for(let i=0;i<n;i++){
      const s = document.createElement("div");
      s.className = "star";
      s.textContent = "â­";
      const x = (Math.random()*160 - 80).toFixed(1) + "px";
      const y = (Math.random()*120 - 60).toFixed(1) + "px";
      s.style.setProperty("--x", x);
      s.style.setProperty("--y", y);
      s.style.left = (50 + Math.random()*30 - 15) + "%";
      s.style.top  = (45 + Math.random()*20 - 10) + "%";
      s.style.animationDelay = (Math.random()*60) + "ms";
      box.appendChild(s);
    }
  }

  // â€”â€” UI æ¸²æŸ“ â€”â€”
  function renderTabs(){
    const tabs = $("tabs");
    tabs.innerHTML = "";
    topicNames.forEach(name=>{
      const b = document.createElement("button");
      b.className = "tab" + (name===currentTopic ? " active" : "");
      b.textContent = name;
      b.onclick = ()=>{
        currentTopic = name;
        renderTabs();
        nextQuestion(true);
      };
      tabs.appendChild(b);
    });
  }

  function setMessage(type, text){
    const msg = $("msg");
    msg.className = "msg " + (type==="ok" ? "ok" : type==="bad" ? "bad" : "");
    msg.textContent = text || "";
  }

  function makeOptions(correctCn){
    const wrongPool = shuffle(allChineseExcept(correctCn));
    const wrong2 = wrongPool.slice(0,2);
    return shuffle([correctCn, ...wrong2]);
  }

  function renderQuestion(autoSpeak=true){
    $("emoji").textContent = current.emoji;
    $("enWord").textContent = current.en;
    $("hint").textContent = "è¯·é€‰æ‹©æ­£ç¡®ä¸­æ–‡ï¼ˆä¹Ÿå¯ä»¥å…ˆå¬å‘éŸ³ï¼‰";
    setMessage("", "");
    locked = false;

    const opts = makeOptions(current.cn);
    const box = $("options");
    box.innerHTML = "";

    opts.forEach(cn=>{
      const btn = document.createElement("button");
      btn.className = "opt";
      btn.textContent = cn;
      btn.onclick = ()=> checkAnswer(btn, cn);
      box.appendChild(btn);
    });

    if(autoSpeak) playWordAudio();
  }

  function setStars(v){
    stars = v;
    $("stars").textContent = String(stars);
  }

  function checkAnswer(btn, selectedCn){
    if(locked) return;
    if(selectedCn === current.cn){
      locked = true;
      btn.classList.add("good");
      setMessage("ok", "âœ… Correct! çœŸæ£’ï¼+1â­");
      beep("ok");
      starBurst();
      setStars(stars + 1);
      // å¼ºåŒ–ï¼šå†è¯»ä¸€æ¬¡
      playWordAudio();
      setTimeout(()=> nextQuestion(), 850);
    }else{
      btn.classList.add("bad");
      setMessage("bad", "âŒ Try again! å†è¯•ä¸€æ¬¡ï½");
      beep("bad");
      setTimeout(()=> btn.classList.remove("bad"), 350);
    }
  }

  function nextQuestion(fromSwitchTopic=false){
    const list = WORDS_BY_TOPIC[currentTopic];
    current = list[Math.floor(Math.random() * list.length)];
    renderQuestion(!fromSwitchTopic);
  }

  // åˆå§‹åŒ–
  renderTabs();
  setStars(0);
  nextQuestion(true);
</script>
</body>
</html>
